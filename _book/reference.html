<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 9 Pass By Value-Reference | Best Coding Practices for R</title>
  <meta name="description" content="This book explains the most important things you need to know while you are writing production level R code." />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 9 Pass By Value-Reference | Best Coding Practices for R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This book explains the most important things you need to know while you are writing production level R code." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 9 Pass By Value-Reference | Best Coding Practices for R" />
  
  <meta name="twitter:description" content="This book explains the most important things you need to know while you are writing production level R code." />
  

<meta name="author" content="Vikram Singh Rawat" />


<meta name="date" content="2021-03-26" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="types.html"/>
<link rel="next" href="loops.html"/>
<script src="libs/header-attrs-2.7/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Best Coding Practices for R </a></li>

<li class="divider"></li>
<li class="part"><span><b>I Introduction</b></span></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>CoverPage</a></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="part"><span><b>II Structure</b></span></li>
<li class="chapter" data-level="2" data-path="folder.html"><a href="folder.html"><i class="fa fa-check"></i><b>2</b> Folder Structure</a>
<ul>
<li class="chapter" data-level="2.1" data-path="folder.html"><a href="folder.html#organizing-files"><i class="fa fa-check"></i><b>2.1</b> Organizing files</a></li>
<li class="chapter" data-level="2.2" data-path="folder.html"><a href="folder.html#create-projects"><i class="fa fa-check"></i><b>2.2</b> Create Projects</a></li>
<li class="chapter" data-level="2.3" data-path="folder.html"><a href="folder.html#naming-files"><i class="fa fa-check"></i><b>2.3</b> Naming files</a></li>
<li class="chapter" data-level="2.4" data-path="folder.html"><a href="folder.html#folders-based-on-file-type"><i class="fa fa-check"></i><b>2.4</b> Folders Based on File-Type</a></li>
<li class="chapter" data-level="2.5" data-path="folder.html"><a href="folder.html#creating-sub-folders"><i class="fa fa-check"></i><b>2.5</b> Creating Sub-folders</a></li>
<li class="chapter" data-level="2.6" data-path="folder.html"><a href="folder.html#conclusion"><i class="fa fa-check"></i><b>2.6</b> Conclusion</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="code.html"><a href="code.html"><i class="fa fa-check"></i><b>3</b> Code Structure</a>
<ul>
<li class="chapter" data-level="3.1" data-path="code.html"><a href="code.html#create-sections"><i class="fa fa-check"></i><b>3.1</b> Create Sections</a></li>
<li class="chapter" data-level="3.2" data-path="code.html"><a href="code.html#order-of-code"><i class="fa fa-check"></i><b>3.2</b> Order of Code</a></li>
<li class="chapter" data-level="3.3" data-path="code.html"><a href="code.html#indentation"><i class="fa fa-check"></i><b>3.3</b> Indentation</a></li>
<li class="chapter" data-level="3.4" data-path="code.html"><a href="code.html#conclusion-1"><i class="fa fa-check"></i><b>3.4</b> Conclusion’</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="func.html"><a href="func.html"><i class="fa fa-check"></i><b>4</b> Functions</a>
<ul>
<li class="chapter" data-level="4.1" data-path="func.html"><a href="func.html#metadata-or-information-header"><i class="fa fa-check"></i><b>4.1</b> Metadata or Information header</a></li>
<li class="chapter" data-level="4.2" data-path="func.html"><a href="func.html#pass-everything-through-parameters"><i class="fa fa-check"></i><b>4.2</b> Pass everything through parameters</a></li>
<li class="chapter" data-level="4.3" data-path="func.html"><a href="func.html#use-return-statement"><i class="fa fa-check"></i><b>4.3</b> Use Return Statement</a></li>
<li class="chapter" data-level="4.4" data-path="func.html"><a href="func.html#keep-a-consistency-in-return-type"><i class="fa fa-check"></i><b>4.4</b> Keep a consistency in Return Type</a></li>
<li class="chapter" data-level="4.5" data-path="func.html"><a href="func.html#use-sensible-names-for-parameters-too"><i class="fa fa-check"></i><b>4.5</b> Use Sensible Names for parameters too…</a></li>
<li class="chapter" data-level="4.6" data-path="func.html"><a href="func.html#use-trycatch"><i class="fa fa-check"></i><b>4.6</b> use tryCatch</a></li>
<li class="chapter" data-level="4.7" data-path="func.html"><a href="func.html#write-simple-and-unique-functions"><i class="fa fa-check"></i><b>4.7</b> Write simple and unique functions</a></li>
<li class="chapter" data-level="4.8" data-path="func.html"><a href="func.html#use-packagefunction-approach"><i class="fa fa-check"></i><b>4.8</b> Use Package::Function() approach</a>
<ul>
<li class="chapter" data-level="4.8.1" data-path="func.html"><a href="func.html#you-should-load-libraries-in-the-order-of-their-usage"><i class="fa fa-check"></i><b>4.8.1</b> You should load libraries in the order of their usage</a></li>
</ul></li>
<li class="chapter" data-level="4.9" data-path="func.html"><a href="func.html#conclusion-2"><i class="fa fa-check"></i><b>4.9</b> Conclusion</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="names.html"><a href="names.html"><i class="fa fa-check"></i><b>5</b> Naming Conventions</a>
<ul>
<li class="chapter" data-level="5.1" data-path="names.html"><a href="names.html#popular-naming-conventions"><i class="fa fa-check"></i><b>5.1</b> Popular naming conventions</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="names.html"><a href="names.html#camelcase"><i class="fa fa-check"></i><b>5.1.1</b> camelCase</a></li>
<li class="chapter" data-level="5.1.2" data-path="names.html"><a href="names.html#pascalcase"><i class="fa fa-check"></i><b>5.1.2</b> PascalCase</a></li>
<li class="chapter" data-level="5.1.3" data-path="names.html"><a href="names.html#snake_case"><i class="fa fa-check"></i><b>5.1.3</b> snake_case</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="names.html"><a href="names.html#informative-names"><i class="fa fa-check"></i><b>5.2</b> Informative Names</a></li>
<li class="chapter" data-level="5.3" data-path="names.html"><a href="names.html#conclusions"><i class="fa fa-check"></i><b>5.3</b> Conclusions</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="envManagement.html"><a href="envManagement.html"><i class="fa fa-check"></i><b>6</b> Environment Management</a>
<ul>
<li class="chapter" data-level="6.1" data-path="envManagement.html"><a href="envManagement.html#renv-for-package-management"><i class="fa fa-check"></i><b>6.1</b> renv for package management</a></li>
<li class="chapter" data-level="6.2" data-path="envManagement.html"><a href="envManagement.html#config-for-external-dependencies"><i class="fa fa-check"></i><b>6.2</b> config for external dependencies</a></li>
<li class="chapter" data-level="6.3" data-path="envManagement.html"><a href="envManagement.html#conclusion-3"><i class="fa fa-check"></i><b>6.3</b> Conclusion</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="dataManagement.html"><a href="dataManagement.html"><i class="fa fa-check"></i><b>7</b> data Management</a>
<ul>
<li class="chapter" data-level="7.1" data-path="dataManagement.html"><a href="dataManagement.html#keep-a-copy-or-your-data"><i class="fa fa-check"></i><b>7.1</b> Keep a Copy or your Data</a></li>
<li class="chapter" data-level="7.2" data-path="dataManagement.html"><a href="dataManagement.html#dont-use-numbers-for-columns"><i class="fa fa-check"></i><b>7.2</b> Don’t use numbers for columns</a></li>
<li class="chapter" data-level="7.3" data-path="dataManagement.html"><a href="dataManagement.html#keep-meaningful-and-proper-column-names"><i class="fa fa-check"></i><b>7.3</b> Keep Meaningful and proper column names</a></li>
<li class="chapter" data-level="7.4" data-path="dataManagement.html"><a href="dataManagement.html#use-databases"><i class="fa fa-check"></i><b>7.4</b> Use Databases</a></li>
<li class="chapter" data-level="7.5" data-path="dataManagement.html"><a href="dataManagement.html#use-efficient-packages"><i class="fa fa-check"></i><b>7.5</b> Use Efficient Packages</a>
<ul>
<li class="chapter" data-level="7.5.1" data-path="dataManagement.html"><a href="dataManagement.html#data.table"><i class="fa fa-check"></i><b>7.5.1</b> data.table</a></li>
<li class="chapter" data-level="7.5.2" data-path="dataManagement.html"><a href="dataManagement.html#matrix"><i class="fa fa-check"></i><b>7.5.2</b> Matrix</a></li>
<li class="chapter" data-level="7.5.3" data-path="dataManagement.html"><a href="dataManagement.html#disk.frame"><i class="fa fa-check"></i><b>7.5.3</b> disk.frame</a></li>
<li class="chapter" data-level="7.5.4" data-path="dataManagement.html"><a href="dataManagement.html#modeldb"><i class="fa fa-check"></i><b>7.5.4</b> modeldb</a></li>
<li class="chapter" data-level="7.5.5" data-path="dataManagement.html"><a href="dataManagement.html#dbplot"><i class="fa fa-check"></i><b>7.5.5</b> dbplot</a></li>
<li class="chapter" data-level="7.5.6" data-path="dataManagement.html"><a href="dataManagement.html#sparklyr"><i class="fa fa-check"></i><b>7.5.6</b> sparklyr</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="dataManagement.html"><a href="dataManagement.html#conclusion-4"><i class="fa fa-check"></i><b>7.6</b> Conclusion</a></li>
</ul></li>
<li class="part"><span><b>III Memory</b></span></li>
<li class="chapter" data-level="8" data-path="types.html"><a href="types.html"><i class="fa fa-check"></i><b>8</b> Type System</a>
<ul>
<li class="chapter" data-level="8.1" data-path="types.html"><a href="types.html#things-you-should-know"><i class="fa fa-check"></i><b>8.1</b> Things you should know</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="types.html"><a href="types.html#r-dont-have-scalar-data-types"><i class="fa fa-check"></i><b>8.1.1</b> R don’t have scalar data types</a></li>
<li class="chapter" data-level="8.1.2" data-path="types.html"><a href="types.html#dates-are-basically-integers-under-the-hood."><i class="fa fa-check"></i><b>8.1.2</b> Dates are basically integers under the hood.</a></li>
<li class="chapter" data-level="8.1.3" data-path="types.html"><a href="types.html#posixlt-are-basically-lists-under-the-hood"><i class="fa fa-check"></i><b>8.1.3</b> POSIXlt are basically lists under the hood</a></li>
<li class="chapter" data-level="8.1.4" data-path="types.html"><a href="types.html#integers-are-smaller-than-numeric"><i class="fa fa-check"></i><b>8.1.4</b> Integers are smaller than numeric</a></li>
<li class="chapter" data-level="8.1.5" data-path="types.html"><a href="types.html#define-your-datatypes-before-the-variable"><i class="fa fa-check"></i><b>8.1.5</b> define your datatypes before the variable</a></li>
<li class="chapter" data-level="8.1.6" data-path="types.html"><a href="types.html#lists-are-better-than-dataframe-under-a-loop"><i class="fa fa-check"></i><b>8.1.6</b> lists are better than dataframe under a loop</a></li>
<li class="chapter" data-level="8.1.7" data-path="types.html"><a href="types.html#use-lists-whenever-possible"><i class="fa fa-check"></i><b>8.1.7</b> use lists whenever possible</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="types.html"><a href="types.html#choose-data-types-carefully"><i class="fa fa-check"></i><b>8.2</b> Choose data types carefully</a></li>
<li class="chapter" data-level="8.3" data-path="types.html"><a href="types.html#dont-change-datatypes"><i class="fa fa-check"></i><b>8.3</b> don’t change datatypes</a></li>
<li class="chapter" data-level="8.4" data-path="types.html"><a href="types.html#future-of-type-system-in-r"><i class="fa fa-check"></i><b>8.4</b> Future of type-system in R</a></li>
<li class="chapter" data-level="8.5" data-path="types.html"><a href="types.html#conclusion-5"><i class="fa fa-check"></i><b>8.5</b> Conclusion</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="reference.html"><a href="reference.html"><i class="fa fa-check"></i><b>9</b> Pass By Value-Reference</a>
<ul>
<li class="chapter" data-level="9.1" data-path="reference.html"><a href="reference.html#understanding-the-system"><i class="fa fa-check"></i><b>9.1</b> Understanding the system</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="reference.html"><a href="reference.html#pass-by-value"><i class="fa fa-check"></i><b>9.1.1</b> Pass by Value</a></li>
<li class="chapter" data-level="9.1.2" data-path="reference.html"><a href="reference.html#pass-by-reference"><i class="fa fa-check"></i><b>9.1.2</b> Pass by reference</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="reference.html"><a href="reference.html#copy-on-modify"><i class="fa fa-check"></i><b>9.2</b> Copy on modify</a></li>
<li class="chapter" data-level="9.3" data-path="reference.html"><a href="reference.html#for-pass-by-reference"><i class="fa fa-check"></i><b>9.3</b> for pass by reference</a></li>
<li class="chapter" data-level="9.4" data-path="reference.html"><a href="reference.html#conclusion-6"><i class="fa fa-check"></i><b>9.4</b> Conclusion</a></li>
</ul></li>
<li class="part"><span><b>IV Speed</b></span></li>
<li class="chapter" data-level="10" data-path="loops.html"><a href="loops.html"><i class="fa fa-check"></i><b>10</b> For Loops</a></li>
<li class="chapter" data-level="11" data-path="multithreading.html"><a href="multithreading.html"><i class="fa fa-check"></i><b>11</b> Multithreading</a></li>
<li class="chapter" data-level="12" data-path="Vectorize.html"><a href="Vectorize.html"><i class="fa fa-check"></i><b>12</b> Vectorize</a></li>
<li class="chapter" data-level="13" data-path="bench.html"><a href="bench.html"><i class="fa fa-check"></i><b>13</b> Benchmarking</a></li>
<li class="chapter" data-level="14" data-path="packages.html"><a href="packages.html"><i class="fa fa-check"></i><b>14</b> packages</a></li>
<li class="part"><span><b>V Production Tools</b></span></li>
<li class="chapter" data-level="15" data-path="syntax.html"><a href="syntax.html"><i class="fa fa-check"></i><b>15</b> Docker</a></li>
<li class="chapter" data-level="16" data-path="proxy.html"><a href="proxy.html"><i class="fa fa-check"></i><b>16</b> Proxy Server</a></li>
<li class="chapter" data-level="17" data-path="cloud.html"><a href="cloud.html"><i class="fa fa-check"></i><b>17</b> Cloud Services</a></li>
<li class="part"><span><b>VI Shiny Tips</b></span></li>
<li class="chapter" data-level="18" data-path="shinyspeed.html"><a href="shinyspeed.html"><i class="fa fa-check"></i><b>18</b> Speed</a></li>
<li class="chapter" data-level="19" data-path="shinymemory.html"><a href="shinymemory.html"><i class="fa fa-check"></i><b>19</b> Memory</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Best Coding Practices for R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="reference" class="section level1" number="9">
<h1><span class="header-section-number">Chapter 9</span> Pass By Value-Reference</h1>
<p>In programming we have a concept of how to pass a value to a function. If we can do away with modification of the object inside the function then it’s okay to pass the original object and let it change else we can create a copy of it and let the function modify it at will without effecting the object itself.</p>
<p>understanding this concept is very crucial if you want to write efficient code. Let’s dive deeper into it.</p>
<div id="understanding-the-system" class="section level2" number="9.1">
<h2><span class="header-section-number">9.1</span> Understanding the system</h2>
<p>There are mostly 2 systems available for passing the objects from one function to another. Let’s understand both of them.</p>
<div id="pass-by-value" class="section level3" number="9.1.1">
<h3><span class="header-section-number">9.1.1</span> Pass by Value</h3>
<p>This is when you create a copy of the original object and pass it to the function. Because you are actually passing just a copy to the function whatever you do to the object doesn’t impact the original one. Let’s check it by an example.</p>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="reference.html#cb119-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">y =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)</span>
<span id="cb119-2"><a href="reference.html#cb119-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-3"><a href="reference.html#cb119-3" aria-hidden="true" tabindex="-1"></a>pass_by_value <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb119-4"><a href="reference.html#cb119-4" aria-hidden="true" tabindex="-1"></a>  x<span class="sc">$</span>y <span class="ot">&lt;-</span> <span class="dv">10</span><span class="sc">:</span><span class="dv">1</span></span>
<span id="cb119-5"><a href="reference.html#cb119-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb119-6"><a href="reference.html#cb119-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-7"><a href="reference.html#cb119-7" aria-hidden="true" tabindex="-1"></a><span class="fu">pass_by_value</span>(x)</span>
<span id="cb119-8"><a href="reference.html#cb119-8" aria-hidden="true" tabindex="-1"></a>x<span class="sc">$</span>y</span></code></pre></div>
<pre><code>##  [1]  1  2  3  4  5  6  7  8  9 10</code></pre>
<p>now x was passed to the function and modified yet it remains same because only copy of the object was passed to the function ( Well, not precisely but this is what we will discuss later).</p>
</div>
<div id="pass-by-reference" class="section level3" number="9.1.2">
<h3><span class="header-section-number">9.1.2</span> Pass by reference</h3>
<p>This is when you pass the entire object as is. Basically you pass the pointer to the original object and now if you change the object you change the original copy of it. Let’s check the same example again.</p>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="reference.html#cb121-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">new.env</span>()</span>
<span id="cb121-2"><a href="reference.html#cb121-2" aria-hidden="true" tabindex="-1"></a>x<span class="sc">$</span>y <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span></span>
<span id="cb121-3"><a href="reference.html#cb121-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-4"><a href="reference.html#cb121-4" aria-hidden="true" tabindex="-1"></a>pass_by_value <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb121-5"><a href="reference.html#cb121-5" aria-hidden="true" tabindex="-1"></a>  x<span class="sc">$</span>y <span class="ot">&lt;-</span> <span class="dv">10</span><span class="sc">:</span><span class="dv">1</span></span>
<span id="cb121-6"><a href="reference.html#cb121-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb121-7"><a href="reference.html#cb121-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-8"><a href="reference.html#cb121-8" aria-hidden="true" tabindex="-1"></a><span class="fu">pass_by_value</span>(x)</span>
<span id="cb121-9"><a href="reference.html#cb121-9" aria-hidden="true" tabindex="-1"></a>x<span class="sc">$</span>y</span></code></pre></div>
<pre><code>##  [1] 10  9  8  7  6  5  4  3  2  1</code></pre>
<p>Now x was passed by reference and no copy was assigned to the function. So when you changed the object inside the function original object was changed.</p>
<p>Hope you now understand practically what does the word mean.</p>
</div>
</div>
<div id="copy-on-modify" class="section level2" number="9.2">
<h2><span class="header-section-number">9.2</span> Copy on modify</h2>
<p>R has no effective means to specify when to pass with value and when to pass with reference. And because there are only 2 ways to deal with this problem everybody assumes that R does create a copy of the object every time it passes the object through a function. But R has a different way of doing things which is called <strong>copy of modify</strong>. There are better blogs written over it and nuances are very peculiar which while writing code you shouldn’t worry about much. I will try to simplify the concept from the practical point of you view so that you can use it in real life without much thought to it.</p>
<p>R basically passes an object by references until you modify it. Let’s check it live:</p>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="reference.html#cb123-1" aria-hidden="true" tabindex="-1"></a>mt_tbl <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(mtcars)</span>
<span id="cb123-2"><a href="reference.html#cb123-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-3"><a href="reference.html#cb123-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tracemem</span>(mt_tbl)</span></code></pre></div>
<pre><code>## [1] &quot;&lt;000000002676FBA0&gt;&quot;</code></pre>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="reference.html#cb125-1" aria-hidden="true" tabindex="-1"></a>dummy_tbl <span class="ot">&lt;-</span> mt_tbl</span>
<span id="cb125-2"><a href="reference.html#cb125-2" aria-hidden="true" tabindex="-1"></a><span class="do">## No tracemem yet</span></span>
<span id="cb125-3"><a href="reference.html#cb125-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-4"><a href="reference.html#cb125-4" aria-hidden="true" tabindex="-1"></a>mpg_col <span class="ot">&lt;-</span> <span class="fu">as.character</span>(mt_tbl<span class="sc">$</span>mpg)</span>
<span id="cb125-5"><a href="reference.html#cb125-5" aria-hidden="true" tabindex="-1"></a><span class="do">## No tracemem yet</span></span>
<span id="cb125-6"><a href="reference.html#cb125-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-7"><a href="reference.html#cb125-7" aria-hidden="true" tabindex="-1"></a>mt_tbl[</span>
<span id="cb125-8"><a href="reference.html#cb125-8" aria-hidden="true" tabindex="-1"></a>  (mt_tbl<span class="sc">$</span>cyl <span class="sc">==</span> <span class="dv">6</span>) <span class="sc">&amp;</span></span>
<span id="cb125-9"><a href="reference.html#cb125-9" aria-hidden="true" tabindex="-1"></a>  (mt_tbl<span class="sc">$</span>hp <span class="sc">&gt;</span> <span class="dv">90</span>),</span>
<span id="cb125-10"><a href="reference.html#cb125-10" aria-hidden="true" tabindex="-1"></a>]</span></code></pre></div>
<pre><code>##                 mpg cyl  disp  hp drat    wt  qsec vs am gear carb
## Mazda RX4      21.0   6 160.0 110 3.90 2.620 16.46  0  1    4    4
## Mazda RX4 Wag  21.0   6 160.0 110 3.90 2.875 17.02  0  1    4    4
## Hornet 4 Drive 21.4   6 258.0 110 3.08 3.215 19.44  1  0    3    1
## Valiant        18.1   6 225.0 105 2.76 3.460 20.22  1  0    3    1
## Merc 280       19.2   6 167.6 123 3.92 3.440 18.30  1  0    4    4
## Merc 280C      17.8   6 167.6 123 3.92 3.440 18.90  1  0    4    4
## Ferrari Dino   19.7   6 145.0 175 3.62 2.770 15.50  0  1    5    6</code></pre>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="reference.html#cb127-1" aria-hidden="true" tabindex="-1"></a><span class="do">## No tracemem yet</span></span>
<span id="cb127-2"><a href="reference.html#cb127-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-3"><a href="reference.html#cb127-3" aria-hidden="true" tabindex="-1"></a><span class="fu">subset</span>(</span>
<span id="cb127-4"><a href="reference.html#cb127-4" aria-hidden="true" tabindex="-1"></a>  mt_tbl,</span>
<span id="cb127-5"><a href="reference.html#cb127-5" aria-hidden="true" tabindex="-1"></a>  cyl <span class="sc">==</span> <span class="dv">6</span>)</span></code></pre></div>
<pre><code>##                 mpg cyl  disp  hp drat    wt  qsec vs am gear carb
## Mazda RX4      21.0   6 160.0 110 3.90 2.620 16.46  0  1    4    4
## Mazda RX4 Wag  21.0   6 160.0 110 3.90 2.875 17.02  0  1    4    4
## Hornet 4 Drive 21.4   6 258.0 110 3.08 3.215 19.44  1  0    3    1
## Valiant        18.1   6 225.0 105 2.76 3.460 20.22  1  0    3    1
## Merc 280       19.2   6 167.6 123 3.92 3.440 18.30  1  0    4    4
## Merc 280C      17.8   6 167.6 123 3.92 3.440 18.90  1  0    4    4
## Ferrari Dino   19.7   6 145.0 175 3.62 2.770 15.50  0  1    5    6</code></pre>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="reference.html#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="do">## No tracemem yet</span></span></code></pre></div>
<p><code>tracemem</code> is a function that will return memory address every time the object is copied. So far it didn’t return anything even though it passed through so many functions and each of those functions must be using multiple functions internally. Yet no copy of the object was made. Because <strong>So Far we haven’t modified anything</strong>. now look at the code below.</p>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb130-1"><a href="reference.html#cb130-1" aria-hidden="true" tabindex="-1"></a>mt_tbl <span class="sc">%&gt;%</span></span>
<span id="cb130-2"><a href="reference.html#cb130-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(cyl <span class="sc">==</span> <span class="dv">6</span>,</span>
<span id="cb130-3"><a href="reference.html#cb130-3" aria-hidden="true" tabindex="-1"></a>         hp <span class="sc">&gt;</span> <span class="dv">90</span>) <span class="sc">%&gt;%</span></span>
<span id="cb130-4"><a href="reference.html#cb130-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(gear) <span class="sc">%&gt;%</span></span>
<span id="cb130-5"><a href="reference.html#cb130-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb130-6"><a href="reference.html#cb130-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(gear)</span></code></pre></div>
<pre><code>## tracemem[0x000000002676fba0 -&gt; 0x0000000026751920]: initialize &lt;Anonymous&gt; filter_rows filter.data.frame filter group_by summarise select %&gt;% eval eval withVisible withCallingHandlers handle timing_fn evaluate_call &lt;Anonymous&gt; evaluate in_dir block_exec call_block process_group.block process_group withCallingHandlers process_file &lt;Anonymous&gt; &lt;Anonymous&gt; render_cur_session render_book render_book_script in_dir &lt;Anonymous&gt; &lt;Anonymous&gt; 
## tracemem[0x0000000026751920 -&gt; 0x00000000267519d0]: initialize &lt;Anonymous&gt; filter_rows filter.data.frame filter group_by summarise select %&gt;% eval eval withVisible withCallingHandlers handle timing_fn evaluate_call &lt;Anonymous&gt; evaluate in_dir block_exec call_block process_group.block process_group withCallingHandlers process_file &lt;Anonymous&gt; &lt;Anonymous&gt; render_cur_session render_book render_book_script in_dir &lt;Anonymous&gt; &lt;Anonymous&gt;</code></pre>
<pre><code>## # A tibble: 3 x 1
##    gear
##   &lt;dbl&gt;
## 1     3
## 2     4
## 3     5</code></pre>
<p>dplyr will change the data.frame to tibble and trigger tracemem This is one of the reason I absolutely love and recommend <strong>data.table</strong> to everybody. Which manages memory very efficiently it’s at par with any in memory table of a DB. If you are actually concerned about memory use data.table.</p>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb133-1"><a href="reference.html#cb133-1" aria-hidden="true" tabindex="-1"></a>new_tbl <span class="ot">&lt;-</span> mt_tbl <span class="sc">%&gt;%</span></span>
<span id="cb133-2"><a href="reference.html#cb133-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(cyl <span class="sc">==</span> <span class="dv">6</span>,</span>
<span id="cb133-3"><a href="reference.html#cb133-3" aria-hidden="true" tabindex="-1"></a>         hp <span class="sc">&gt;</span> <span class="dv">90</span>) <span class="sc">%&gt;%</span></span>
<span id="cb133-4"><a href="reference.html#cb133-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(gear) <span class="sc">%&gt;%</span></span>
<span id="cb133-5"><a href="reference.html#cb133-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb133-6"><a href="reference.html#cb133-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(gear)</span></code></pre></div>
<pre><code>## tracemem[0x000000002676fba0 -&gt; 0x00000000269037a8]: initialize &lt;Anonymous&gt; filter_rows filter.data.frame filter group_by summarise select %&gt;% eval eval withVisible withCallingHandlers handle timing_fn evaluate_call &lt;Anonymous&gt; evaluate in_dir block_exec call_block process_group.block process_group withCallingHandlers process_file &lt;Anonymous&gt; &lt;Anonymous&gt; render_cur_session render_book render_book_script in_dir &lt;Anonymous&gt; &lt;Anonymous&gt; 
## tracemem[0x00000000269037a8 -&gt; 0x0000000026903858]: initialize &lt;Anonymous&gt; filter_rows filter.data.frame filter group_by summarise select %&gt;% eval eval withVisible withCallingHandlers handle timing_fn evaluate_call &lt;Anonymous&gt; evaluate in_dir block_exec call_block process_group.block process_group withCallingHandlers process_file &lt;Anonymous&gt; &lt;Anonymous&gt; render_cur_session render_book render_book_script in_dir &lt;Anonymous&gt; &lt;Anonymous&gt;</code></pre>
<p>now we are modifying the results somewhere and thus a copy is created. The actual rules are very very complicated. But in simple term as long as you don’t modify any thing R doesn’t create a copy and everything is passed down by reference.</p>
<p>It impacts speed too… Let check it by an example</p>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb135-1"><a href="reference.html#cb135-1" aria-hidden="true" tabindex="-1"></a>foo <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb135-2"><a href="reference.html#cb135-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sum</span>(x)</span>
<span id="cb135-3"><a href="reference.html#cb135-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb135-4"><a href="reference.html#cb135-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-5"><a href="reference.html#cb135-5" aria-hidden="true" tabindex="-1"></a>bar <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb135-6"><a href="reference.html#cb135-6" aria-hidden="true" tabindex="-1"></a>  x[[<span class="dv">1</span>]] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb135-7"><a href="reference.html#cb135-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sum</span>(x)</span>
<span id="cb135-8"><a href="reference.html#cb135-8" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>As you can see both the functions are identical the only difference is that in <code>bar</code> I am modifying the object while in <code>foo</code> I am not changing the object. Let’s run a speed test…</p>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb136-1"><a href="reference.html#cb136-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="fl">1e7</span>)</span>
<span id="cb136-2"><a href="reference.html#cb136-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-3"><a href="reference.html#cb136-3" aria-hidden="true" tabindex="-1"></a>microbenchmark<span class="sc">::</span><span class="fu">microbenchmark</span>(</span>
<span id="cb136-4"><a href="reference.html#cb136-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">foo =</span> <span class="fu">foo</span>(x),</span>
<span id="cb136-5"><a href="reference.html#cb136-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">bar =</span> <span class="fu">bar</span>(x),</span>
<span id="cb136-6"><a href="reference.html#cb136-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">times =</span> <span class="dv">10</span></span>
<span id="cb136-7"><a href="reference.html#cb136-7" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## Unit: milliseconds
##  expr     min      lq    mean   median      uq     max neval cld
##   foo  8.3321  8.4346  9.0041  8.55765  8.9522 12.1517    10  a 
##   bar 22.7959 22.9301 24.0792 23.30765 23.9799 28.8234    10   b</code></pre>
<p>As you can see the difference in time is because <code>bar</code> is creating a copy of the object. And you may assume that it will create a copy at every time you change a object and you will be dead wrong as R is smart enough to understand that It can get away with only single copy of the object. Lets create a function that changes more things in x and see the difference.</p>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb138-1"><a href="reference.html#cb138-1" aria-hidden="true" tabindex="-1"></a>bar_new <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb138-2"><a href="reference.html#cb138-2" aria-hidden="true" tabindex="-1"></a>  x[[<span class="dv">1</span>]] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb138-3"><a href="reference.html#cb138-3" aria-hidden="true" tabindex="-1"></a>  x[[<span class="dv">10</span>]] <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb138-4"><a href="reference.html#cb138-4" aria-hidden="true" tabindex="-1"></a>  x[[<span class="fl">1e3</span>]] <span class="ot">&lt;-</span> <span class="fl">1e3</span></span>
<span id="cb138-5"><a href="reference.html#cb138-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sum</span>(x)</span>
<span id="cb138-6"><a href="reference.html#cb138-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb138-7"><a href="reference.html#cb138-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-8"><a href="reference.html#cb138-8" aria-hidden="true" tabindex="-1"></a>microbenchmark<span class="sc">::</span><span class="fu">microbenchmark</span>(</span>
<span id="cb138-9"><a href="reference.html#cb138-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">foo =</span> <span class="fu">foo</span>(x),</span>
<span id="cb138-10"><a href="reference.html#cb138-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">bar =</span> <span class="fu">bar</span>(x),</span>
<span id="cb138-11"><a href="reference.html#cb138-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">bar_new =</span> <span class="fu">bar_new</span>(x),</span>
<span id="cb138-12"><a href="reference.html#cb138-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">times =</span> <span class="dv">10</span></span>
<span id="cb138-13"><a href="reference.html#cb138-13" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## Unit: milliseconds
##     expr     min      lq     mean   median      uq     max neval cld
##      foo  8.2674  8.2994  8.55083  8.52115  8.7722  9.0764    10  a 
##      bar 22.7673 22.9007 31.51179 23.43545 25.6712 99.1793    10   b
##  bar_new 22.9896 23.3754 23.89767 23.44770 24.2275 25.9499    10   b</code></pre>
<p>Now as you can see that while the function foo and bar have significant differences in performance, same is not true for bar and bar_new. Because bar_new too creates a copy but maintains that copy for the entire function.</p>
<p>So R is smart enough to understand when to create a copy and when not to create a copy. Once a copy is created it is retained in R and R uses it smartly. We can gain speed and memory benefits by making sure all the modification is done inside a single function. So that R doesn’t create much copies.</p>
<p>Instead of using bar 3 times it’s better to use bar_new once. So that you don’t copy it multiple times. See the difference for yourself. And thus <strong>try to keep all the modifications close and in as less functions as possible</strong>.</p>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb140-1"><a href="reference.html#cb140-1" aria-hidden="true" tabindex="-1"></a>microbenchmark<span class="sc">::</span><span class="fu">microbenchmark</span>(</span>
<span id="cb140-2"><a href="reference.html#cb140-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">bar =</span> {</span>
<span id="cb140-3"><a href="reference.html#cb140-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bar</span>(x)</span>
<span id="cb140-4"><a href="reference.html#cb140-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bar</span>(x)</span>
<span id="cb140-5"><a href="reference.html#cb140-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bar</span>(x)</span>
<span id="cb140-6"><a href="reference.html#cb140-6" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb140-7"><a href="reference.html#cb140-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">bar_new =</span> <span class="fu">bar_new</span>(x),</span>
<span id="cb140-8"><a href="reference.html#cb140-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">times =</span> <span class="dv">10</span></span>
<span id="cb140-9"><a href="reference.html#cb140-9" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## Unit: milliseconds
##     expr     min      lq      mean   median       uq      max neval cld
##      bar 67.9847 73.0376 110.09637 75.26350 130.1980 264.0576    10   b
##  bar_new 23.0963 24.2927  25.77776 24.96485  27.1684  29.9117    10  a</code></pre>
<p>best is to group these modifications together.</p>
<p>So the gist of the matter is:</p>
<ol style="list-style-type: decimal">
<li>R passes everything by reference until you modify it</li>
<li>R creates a copy when you modify the object</li>
<li>You should always keep all the Object modifications in same function</li>
</ol>
</div>
<div id="for-pass-by-reference" class="section level2" number="9.3">
<h2><span class="header-section-number">9.3</span> for pass by reference</h2>
<p>As I told you before R has no way of specifying when the object will be pass by reference and when it will be passed by value. And there are certainly times you wish you had passed it by value and certainly times when you wish you passed it by reference.</p>
<p>When you modify something inside a function you create a copy of it. So take example of a loop inside and outside a function</p>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb142-1"><a href="reference.html#cb142-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="dv">10</span>)</span>
<span id="cb142-2"><a href="reference.html#cb142-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>){</span>
<span id="cb142-3"><a href="reference.html#cb142-3" aria-hidden="true" tabindex="-1"></a>  x[[i]] <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">1</span>)</span>
<span id="cb142-4"><a href="reference.html#cb142-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb142-5"><a href="reference.html#cb142-5" aria-hidden="true" tabindex="-1"></a>x</span></code></pre></div>
<pre><code>##  [1] -0.62699314 -1.16810425  1.23961013  0.48383496  0.61872715  0.06284149
##  [7] -0.63595299  1.10870584  0.10175430  0.67721856</code></pre>
<p>It modifies the object in place. Now lets wrap it in a function and see what happens.</p>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb144-1"><a href="reference.html#cb144-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="dv">10</span>)</span>
<span id="cb144-2"><a href="reference.html#cb144-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-3"><a href="reference.html#cb144-3" aria-hidden="true" tabindex="-1"></a>foo <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb144-4"><a href="reference.html#cb144-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>){</span>
<span id="cb144-5"><a href="reference.html#cb144-5" aria-hidden="true" tabindex="-1"></a>    x[[i]] <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">1</span>)</span>
<span id="cb144-6"><a href="reference.html#cb144-6" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb144-7"><a href="reference.html#cb144-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(x)</span>
<span id="cb144-8"><a href="reference.html#cb144-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb144-9"><a href="reference.html#cb144-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-10"><a href="reference.html#cb144-10" aria-hidden="true" tabindex="-1"></a><span class="fu">foo</span>(x)</span></code></pre></div>
<pre><code>##  [1] -1.3557271 -0.4499918 -0.6147331 -1.0472309 -0.3556228 -0.4305612
##  [7] -0.1251895 -0.7638334 -0.2739515 -1.8029968</code></pre>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb146-1"><a href="reference.html#cb146-1" aria-hidden="true" tabindex="-1"></a>x</span></code></pre></div>
<pre><code>##  [1] 0 0 0 0 0 0 0 0 0 0</code></pre>
<p>Now x is not modified because it is being modified inside a function. This is crucial at times when you are running a long job that might take hours to complete just to find an error in the middle. You might want to start the loop from the exact position you left off. With this sort of code you will not reach that. Let’s generate an error in the code and uses bigger number.</p>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb148-1"><a href="reference.html#cb148-1" aria-hidden="true" tabindex="-1"></a>total_length <span class="ot">&lt;-</span> <span class="fl">1e2</span></span></code></pre></div>
<div class="sourceCode" id="cb149"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb149-1"><a href="reference.html#cb149-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb149-2"><a href="reference.html#cb149-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-3"><a href="reference.html#cb149-3" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">numeric</span>(total_length)</span>
<span id="cb149-4"><a href="reference.html#cb149-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-5"><a href="reference.html#cb149-5" aria-hidden="true" tabindex="-1"></a>foo <span class="ot">&lt;-</span> <span class="cf">function</span>(number){</span>
<span id="cb149-6"><a href="reference.html#cb149-6" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span>total_length,<span class="dv">1</span>)</span>
<span id="cb149-7"><a href="reference.html#cb149-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>total_length){</span>
<span id="cb149-8"><a href="reference.html#cb149-8" aria-hidden="true" tabindex="-1"></a>    number[[i]] <span class="ot">&lt;-</span> i</span>
<span id="cb149-9"><a href="reference.html#cb149-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(y <span class="sc">==</span> i){</span>
<span id="cb149-10"><a href="reference.html#cb149-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">stop</span>(<span class="fu">sprintf</span>(<span class="st">&quot;there is an error at %s&quot;</span>, y))</span>
<span id="cb149-11"><a href="reference.html#cb149-11" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb149-12"><a href="reference.html#cb149-12" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb149-13"><a href="reference.html#cb149-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(number)</span>
<span id="cb149-14"><a href="reference.html#cb149-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb149-15"><a href="reference.html#cb149-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-16"><a href="reference.html#cb149-16" aria-hidden="true" tabindex="-1"></a><span class="fu">foo</span>(x) <span class="do">## You will get an Error</span></span></code></pre></div>
<pre><code>## Error in foo(x): there is an error at 68</code></pre>
<p>If you run this code you will get an error at some number and x will still be the same. All the processing of code till that moment is lost for everybody. Which is not what you want if each iteration took just 2 minutes to run. This difference could mean hours in some scenarios.</p>
<p>R has 4 datatypes that provide mutable objects or pass by reference semantics.</p>
<ol style="list-style-type: decimal">
<li>R6 Classes</li>
<li>environments</li>
<li>data.table</li>
<li>listenv</li>
</ol>
<p>I wouldn’t recommend writing an R6 class just to run a simple loop, however if your use case is pretty complex R6 would be a valid solution for it. We already saw how environments can be used for pass by reference. But passing around environments is not a good idea it requires you to know too much about the language and be very careful with what you are doing hence I only prefer 2 approaches. One with data.table and other with listenv package.</p>
<p>But their usecase is very different. One should be used where you are comfortable with lists are more suited while other should be used where data.frame or vectors are more suited for the task. Doing it for listenv is very easy. It’s the same code with just the new listenv object.</p>
<div class="sourceCode" id="cb151"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb151-1"><a href="reference.html#cb151-1" aria-hidden="true" tabindex="-1"></a>foo_list <span class="ot">&lt;-</span> <span class="cf">function</span>(list){</span>
<span id="cb151-2"><a href="reference.html#cb151-2" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span>total_length,<span class="dv">1</span>)</span>
<span id="cb151-3"><a href="reference.html#cb151-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>total_length){</span>
<span id="cb151-4"><a href="reference.html#cb151-4" aria-hidden="true" tabindex="-1"></a>    list<span class="sc">$</span>x[[i]] <span class="ot">&lt;-</span> i</span>
<span id="cb151-5"><a href="reference.html#cb151-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(y <span class="sc">==</span> i){</span>
<span id="cb151-6"><a href="reference.html#cb151-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">stop</span>(<span class="fu">sprintf</span>(<span class="st">&quot;there is an error at %s&quot;</span>, y))</span>
<span id="cb151-7"><a href="reference.html#cb151-7" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb151-8"><a href="reference.html#cb151-8" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb151-9"><a href="reference.html#cb151-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb151-10"><a href="reference.html#cb151-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-11"><a href="reference.html#cb151-11" aria-hidden="true" tabindex="-1"></a>list_env <span class="ot">&lt;-</span> listenv<span class="sc">::</span><span class="fu">listenv</span>()</span>
<span id="cb151-12"><a href="reference.html#cb151-12" aria-hidden="true" tabindex="-1"></a>list_env<span class="sc">$</span>x <span class="ot">&lt;-</span> <span class="fu">numeric</span>(total_length)</span>
<span id="cb151-13"><a href="reference.html#cb151-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-14"><a href="reference.html#cb151-14" aria-hidden="true" tabindex="-1"></a><span class="fu">foo_list</span>(list_env)</span></code></pre></div>
<pre><code>## Error in foo_list(list_env): there is an error at 39</code></pre>
<p>Now again we got an errors but this time all the other changes have been saved in x.</p>
<div class="sourceCode" id="cb153"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb153-1"><a href="reference.html#cb153-1" aria-hidden="true" tabindex="-1"></a>list_env<span class="sc">$</span>x</span></code></pre></div>
<pre><code>##   [1]  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25
##  [26] 26 27 28 29 30 31 32 33 34 35 36 37 38 39  0  0  0  0  0  0  0  0  0  0  0
##  [51]  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0
##  [76]  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0</code></pre>
<p>Same thing could be done in data.table as well. let’s write a new function for doing it. data.table has 2 ways of looping through the vectors.</p>
<ol style="list-style-type: decimal">
<li>With <code>:=</code> operator which is slow but useful for more data insertion than one by one</li>
<li>with <code>set</code> function which is faster where you need to insert data one by one.</li>
</ol>
<p>Let’s use the second approach to write a function.</p>
<div class="sourceCode" id="cb155"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb155-1"><a href="reference.html#cb155-1" aria-hidden="true" tabindex="-1"></a>x_dt <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">data.table</span>(<span class="at">x =</span> <span class="fu">numeric</span>(total_length))</span>
<span id="cb155-2"><a href="reference.html#cb155-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-3"><a href="reference.html#cb155-3" aria-hidden="true" tabindex="-1"></a>foo_dt <span class="ot">&lt;-</span> <span class="cf">function</span>(dt){</span>
<span id="cb155-4"><a href="reference.html#cb155-4" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span>total_length,<span class="dv">1</span>)</span>
<span id="cb155-5"><a href="reference.html#cb155-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>total_length){</span>
<span id="cb155-6"><a href="reference.html#cb155-6" aria-hidden="true" tabindex="-1"></a>    data.table<span class="sc">::</span><span class="fu">set</span>(</span>
<span id="cb155-7"><a href="reference.html#cb155-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> dt,</span>
<span id="cb155-8"><a href="reference.html#cb155-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">i =</span> i,</span>
<span id="cb155-9"><a href="reference.html#cb155-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">j =</span> <span class="st">&quot;x&quot;</span>,</span>
<span id="cb155-10"><a href="reference.html#cb155-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">value =</span> i)</span>
<span id="cb155-11"><a href="reference.html#cb155-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-12"><a href="reference.html#cb155-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(y <span class="sc">==</span> i){</span>
<span id="cb155-13"><a href="reference.html#cb155-13" aria-hidden="true" tabindex="-1"></a>      <span class="fu">stop</span>(<span class="fu">sprintf</span>(<span class="st">&quot;there is an error at %s&quot;</span>, y))</span>
<span id="cb155-14"><a href="reference.html#cb155-14" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb155-15"><a href="reference.html#cb155-15" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb155-16"><a href="reference.html#cb155-16" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb155-17"><a href="reference.html#cb155-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-18"><a href="reference.html#cb155-18" aria-hidden="true" tabindex="-1"></a><span class="fu">foo_dt</span>(x_dt)</span></code></pre></div>
<pre><code>## Error in foo_dt(x_dt): there is an error at 1</code></pre>
<p>Now just like again even though we got errors we can still check the ones that have been completed during the loop.</p>
<div class="sourceCode" id="cb157"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb157-1"><a href="reference.html#cb157-1" aria-hidden="true" tabindex="-1"></a>x_dt<span class="sc">$</span>x</span></code></pre></div>
<pre><code>##   [1] 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
##  [38] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
##  [75] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0</code></pre>
<p>So let me make things simpler. When you want to modify objects in place you need to use 1 of the 2 approach. <strong>When you are working on data.frames and vectors use data.table while when you are working on anything else, anything in general, use listenv approach</strong>.</p>
</div>
<div id="conclusion-6" class="section level2" number="9.4">
<h2><span class="header-section-number">9.4</span> Conclusion</h2>
<p>This chapter focused on how to save memory of your R program by using objects through reference and avoid creating copies of the object. Let’s summarize what we have read so far.</p>
<ol style="list-style-type: decimal">
<li>keep all the modifications of objects in a single function</li>
<li>use pass by reference through listenv and data.table for saving memory</li>
<li>avoid creating multiple copies of an object at all costs</li>
</ol>

</div>
</div>



            </section>

          </div>
        </div>
      </div>
<a href="types.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="loops.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/vikram-rawat/Best_R_Practices/blob/master/03-mem_02_reference.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["best_r_practices.pdf", "best_r_practices.epub"],
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
